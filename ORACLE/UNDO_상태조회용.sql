
/* UNDO 관련 */

-- 현재 UNDO 상태 확인 
SELECT 
    DISTINCT STATUS , ROUND(SUM(BYTES)/1024/1024/1024,2) GB , COUNT(*) 
FROM DBA_UNDO_EXTENTS
GROUP BY STATUS ORDER BY 1;        



/* ORACLE/TIBERO */
	SELECT 
		A.TABLESPACE_NAME, 
        ROUND(A.SIZE_GB,2) "TOTAL_SIZE(GB)",
		ROUND(B.ACTIVE_SIZE_GB,2) "ACTIVE_SIZE(GB)",
		ROUND(B.UNEXPIRED_SIZE_GB,2) "UNEXPIRED_SIZE(GB)",
		ROUND((A.SIZE_GB - B.ACTIVE_SIZE_GB - B.UNEXPIRED_SIZE_GB ),2) AS "AVAILABLE_SIZE(GB)"
	FROM 
		( SELECT 
			TABLESPACE_NAME,
			SUM(BYTES)/1024/1024/1024 AS SIZE_GB
		  FROM DBA_DATA_FILES
		  WHERE TABLESPACE_NAME LIKE 'UNDO%'
		  GROUP BY TABLESPACE_NAME ) A 
		INNER JOIN 
		( SELECT 
			TABLESPACE_NAME,
			TO_CHAR(SYSDATE, 'YYYYMMDD HH24MISS') TIME,
			NVL(SUM(DECODE(STATUS, 'ACTIVE', BYTES) /1024/1024/1024), 0 )
			ACTIVE_SIZE_GB,
			SUM(DECODE(STATUS, 'EXPIRED', BYTES)/1024/1024/0124) EXPIRED_SIZE_GB,
			SUM(DECODE(STATUS, 'UNEXPIRED', BYTES) /1024/1024/1024 ) UNEXPIRED_SIZE_GB 
		 FROM DBA_UNDO_EXTENTS
		 WHERE TABLESPACE_NAME LIKE 'UNDO%'
		 GROUP BY TABLESPACE_NAME ) B 
		ON A.TABLESPACE_NAME = B.TABLESPACE_NAME 
	ORDER BY 1;
		 
			
			
			